<!DOCTYPE HTML>

<html>
    
	<head>
		<title>Louguan Star's Blog</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="baidu-site-verification" content="TXUGY4f1Fu" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="/js/jquery.min.js"></script>
		<script src="/js/jquery.scrollzer.min.js"></script>
		<script src="/js/jquery.scrolly.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-layers.min.js"></script>
		<script src="/js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="/css/skel.css" />
			<link rel="stylesheet" href="/css/style.css" />
			<link rel="stylesheet" href="/css/style-xlarge.css" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>

    <body>
        <div id="wrapper">
        <!-- Header -->
    <section id="header" class="skel-layers-fixed">
        <header>
            <span class="image avatar"><img src="/images/avatar.jpg" alt="" /></span>
            <h1 id="logo"><a href="/">Louguan Star</a></h1>
            <p>心之安处，便是吾乡...</p>
        </header>
        <nav id="nav">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>
        <footer>
            <ul class="icons">
                <!-- <li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li> -->
                <!-- <li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li> -->
                <!-- <li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li> -->
                <li><a href="https://github.com/maozi07" class="icon fa-github"><span class="label">Github</span></a></li>
                <li><a href="#" class="icon fa-envelope"><span class="label">Email</span></a></li>
            </ul>
        </footer>
    </section>


            <!-- Main -->
            <div id="main">
                <section>
    <div class="container">
        <header class="major">
            <h2>Cdh安装</h2>
                <p class="post-meta">Jul 5, 2017</p>
        </header>

        <section class="post-content">
            <h3 id="section">准备工作</h3>
<ul>
  <li>
    <p>java相应版本</p>
  </li>
  <li>
    <p>mysql(mariadb/postgresql)</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>#以mariadb为例
https://mariadb.com/kb/en/mariadb/installing-mariadb-binary-tarballs/
groupadd mysql
useradd -g mysql mysql
tar -zxvf mariadb-10.1.13-linux-x86_64.tar.gz
ln -s mariadb-10.1.13-linux-x86_64 mysql
cd mysql
./scripts/mysql_install_db --user=mysql
chown -R root .
chown -R mysql data
./bin/mysqld_safe --user=mysql &amp;
./bin/mysqladmin -u root password '123456'
cp support-files/mysql.server /etc/init.d/mysql.server

grant all privileges on *.* to root@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
flush privileges;
</code></pre>
</div>

<h3 id="parcel">使用parcel</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir /opt/cloudera-manager
tar -xzvf cloudera-manager-el5-cm5.6.0_x86_64.tar.gz -C /opt/cloudera-manager
useradd --system --home=/opt/cloudera-manager/cm-5.6.0/run/cloudera-scm-server --no-create-home --shell=/bin/false --comment "Cloudera SCM User" cloudera-scm
#prepare database
./scm_prepare_database.sh mysql localhost cdh -uroot -p123456

mkdir /var/log/cloudera-scm-server
chown cloudera-scm:cloudera-scm /var/log/cloudera-scm-server

mkdir -p /opt/cloudera/parcel-repo
mkdir -p /opt/cloudera/parcels
</code></pre>
</div>

<h3 id="rpm">使用rpm包</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>#server:
rpm -ivh cloudera-manager-daemons-5.6.0-1.cm560.p0.54.el5.x86_64.rpm
rpm -ivh cloudera-manager-server-5.6.0-1.cm560.p0.54.el5.x86_64.rpm

#agent:
rpm -ivh cloudera-manager-daemons-5.6.0-1.cm560.p0.54.el5.x86_64.rpm
rpm -ivh cloudera-manager-agent-5.6.0-1.cm560.p0.54.el5.x86_64.rpm
#databae
/usr/share/cmf/schema/scm_prepare_database.sh mysql -h localhost -uroot -p123456 scm scm scm
</code></pre>
</div>

<h3 id="yum">使用本地yum源安装</h3>
<ul>
  <li>hdfs</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>#Namenode server:
yum -y install hadoop hadoop-hdfs hadoop-client hadoop-doc hadoop-debuginfo hadoop-hdfs-namenode hadoop-httpfs

#Secondnary namenode server:
yum -y install hadoop-hdfs-secondarynamenode

#Data node:
yum -y install hadoop hadoop-hdfs hadoop-client hadoop-doc hadoop-debuginfo hadoop-hdfs-datanode

#journal node:
yum -y install hadoop-hdfs-journalnode hadoop-hdfs-zkfc
#creat dirs
mkdir -p /data/hadoop/dfs/{data,jn,name}
chown -R hdfs:hdfs /data/hadoop/dfs/

mkdir -p /data/hadoop/tmp/dfs/{data,jn,name}
chown -R hdfs:hdfs /data/hadoop/tmp
#format hdfs
sudo -u hdfs hadoop namenode -format
</code></pre>
</div>
<ul>
  <li>yarn</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>#resource manager:
yum -y install hadoop-yarn hadoop-yarn-resourcemanager hadoop-mapreduce-historyserver hadoop-yarn-proxyserver

#node manager:
yum -y install hadoop-yarn hadoop-yarn-nodemanager hadoop-mapreduce
#create dirs
mkdir -p /data/hadoop/yarn/{local,logs}
chown -R yarn:yarn /data/hadoop/yarn
sudo -u hdfs hadoop fs -mkdir -p /var/log/hadoop-yarn/apps
sudo -u hdfs hadoop fs -chown -R yarn:yarn /var/log/hadoop-yarn
mkdir -p /data/hadoop/tmp/mapred/staging/history/done
chown -R yarn:yarn /data/hadoop/tmp/mapred
sudo -u hdfs hadoop fs -mkdir -p /data/hadoop/tmp/mapred
sudo -u hdfs hadoop fs -chown -R mapred:mapred /data/hadoop/tmp/mapred
#start process
/etc/init.d/hadoop-yarn-resourcemanager start
/etc/init.d/hadoop-yarn-nodemanager start
/etc/init.d/hadoop-mapreduce-historyserver start
#run a test
sudo -u hdfs hadoop jar /usr/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar pi 10 10
</code></pre>
</div>

<ul>
  <li>hive</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>#metastore:
yum -y install hive hive-metastore hive-server2 hive-jdbc
yum -y install hive hive-server2 hive-jdbc
#mysql for metastore
yum -y install mysql-libs mysql-devel
ln -s /usr/share/java/mysql-connector-java.jar /usr/lib/hive/lib/mysql-connector-java.jar
mysql -u root -p123456 -e "
    CREATE DATABASE metastore;
    USE metastore;
    SOURCE /usr/lib/hive/scripts/metastore/upgrade/mysql/hive-schema-1.1.0.mysql.sql;
    CREATE USER 'hiveuser'@'master' IDENTIFIED BY '123456';
    GRANT ALL PRIVILEGES ON metastore.* TO 'hiveuser'@'master';
    GRANT ALL PRIVILEGES ON metastore.* TO 'hiveuser'@'%';
    FLUSH PRIVILEGES;
"
#create dirs
sudo -u hdfs hadoop fs -mkdir -p /user/hive/warehouse
sudo -u hdfs hadoop fs -chown -R hive:hive /user/hive
sudo -u hdfs hadoop fs -chmod 1777 /user/hive/warehouse
#start process
/etc/init.d/hive-metastore start
/etc/init.d/hive-server2 start

hive开启并发必须启动zookeeper
</code></pre>
</div>

        </section>

        <footer>
            
            <a href="/2017/03/17/HDSF%E4%B8%8Aget%E6%95%B0%E6%8D%AE%E5%90%8E%E6%96%87%E4%BB%B6%E5%A4%A710%E5%80%8D.html" class="float-left">&larr; Previous</a> 
            
            <a href="/2017/07/07/%E5%85%B3%E4%BA%8Emysql.html" class="float-right">Next &rarr;</a> 

        </footer>

        <div id="footer" class="copyright">
            <ul class="copyright">
                <li>本文系原创，转载请注明：转自<a target="_blank" href="http://www.louguanstar.com">LouguanStar's Blog</a>，作者：<a target="_blank" href="http://wwww.louguanstar.com/about/">LouguanStar</a></li>
                <li>除特别说明外，本文基于<a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/cn/">知识共享署名-相同方式共享 3.0 中国大陆许可协议</a>发布，转载或其它引用请保留文本署名和文章链接。</li>
            </ul>
        </div>

    </div>

</section>


            </div>
            <!-- Footer -->
    <section id="footer">
        <div class="container">
            <ul class="copyright">
                <li>&copy;2016&nbsp;Louguan Star. &nbsp;All rights reserved.&nbsp;Powered by jekyll.</li>
            </ul>
        </div>
    </section>

		</div>
	</body>
</html>
